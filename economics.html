<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Economics â€” JojoJubah</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Use complete site styles with AI chatbot integration -->
  <link rel="stylesheet" href="css/style.css">
  
  <!-- Market Ticker Styles -->
  <style>
    #market-banner {
      background: linear-gradient(90deg, rgba(34, 197, 94, 0.15), rgba(16, 185, 129, 0.1));
      border-top: 2px solid rgba(34, 197, 94, 0.3);
      border-bottom: 2px solid rgba(34, 197, 94, 0.3);
      padding: 0;
      margin: 2rem 0;
      overflow: hidden;
      height: 50px;
      display: flex;
      align-items: center;
      position: relative;
    }

    .ticker-container {
      width: 100%;
      overflow: hidden;
      position: relative;
    }

    .ticker-content {
      display: flex;
      align-items: center;
      height: 50px;
    }

    .ticker-wrapper {
      display: flex;
      width: max-content; /* important for seamless scroll */
      animation: ticker-scroll 30s linear infinite;
    }

    .ticker-track {
      display: flex;
    }

    .ticker-item {
      padding: 0 2rem;
      font-size: 1rem;
      font-weight: 500;
      white-space: nowrap;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Seamless scroll: move half-width so track2 hands off to track1 with no gap */
    @keyframes ticker-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

    .ticker-refresh {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.4);
      border-radius: 999px;
      color: #065f46;
      padding: 6px 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
      transition: all 0.2s ease;
      z-index: 2;
    }

    .ticker-refresh:hover {
      background: rgba(16, 185, 129, 0.25);
      transform: translateY(-50%) scale(1.02);
    }
    
    .ticker-refresh.loading {
      opacity: 0.6;
      cursor: wait;
    }
    
    .refresh-icon {
      display: inline-block;
      transform-origin: center;
    }
    
    .ticker-refresh.loading .refresh-icon {
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Mobile tweaks */
    @media (max-width: 640px) {
      #market-banner { height: 44px; }
      .ticker-item { padding: 0 1rem; font-size: 0.95rem; }
      .ticker-refresh { font-size: 0.85rem; padding: 5px 9px; right: 8px; }
    }
  </style>
</head>

<body>
  <!-- Header/Nav -->
  <header>
    <nav class="navbar">
      <div class="container">
        <a href="index.html" class="logo">
          <span class="logo-text">JojoJubah</span>
        </a>

        <button class="menu-toggle" aria-label="Toggle navigation">â˜°</button>
        <div class="nav-links">
          <a href="index.html">Home</a>
          <a href="economics.html" class="active">Economics</a>
          <a href="labs.html">Labs</a>
          <a href="https://www.youtube.com/@jojojubah" target="_blank" rel="noopener">YouTube</a>
        </div>
      </div>
    </nav>
  </header>

  <main>
    <!-- Hero -->
    <section id="home" style="min-height:60vh;display:flex;align-items:center;justify-content:center;text-align:center">
      <div class="container">
        <h1 class="hero-title">Welcome to <span class="gradient-text">Economics</span></h1>
        <p class="hero-subtitle">Plain-English notes on money, markets, and decisionsâ€”made for creators.</p>
        <p class="hero-subtitle" style="font-size:1rem;margin-top:0.75rem;opacity:0.8">ðŸ’¡ Ask the AI assistant about any economic concept!</p>
      </div>
    </section>

    <!-- Market Banner -->
    <section id="market-banner">
      <div class="ticker-container">
        <div class="ticker-content">
          <div class="ticker-wrapper" id="tickerWrapper">
            <div class="ticker-track" id="tickerTrack1">
              <span class="ticker-item">ðŸ“Š Loading market data...</span>
            </div>
            <!-- Duplicate track for seamless loop -->
            <div class="ticker-track" id="tickerTrack2">
              <span class="ticker-item">ðŸ“Š Loading market data...</span>
            </div>
          </div>
        </div>
        <button id="refreshBanner" class="ticker-refresh" aria-label="Refresh market data" title="Refresh market data">
          <span class="refresh-icon">ðŸ”„</span>
        </button>
      </div>
    </section>

    <!-- Starter content (enhanced with AI assistant & links) -->
    <section class="projects container" id="projects" style="margin-top:2rem">
      <h2 class="section-title">Quick Economics Notes</h2>

      <div class="projects-grid">
        <div class="project-card fade-in">
          <div class="project-content">
            <h3 class="project-title">Inflation Basics</h3>
            <p class="project-description">
              Inflation is the general rise in prices over time, which reduces your purchasing power. If your money grows
              slower than prices rise, you can buy less with the same pound. We'll cover CPI, core inflation, and how
              central banks respond.
            </p>
            <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
              <a href="#" class="btn">Read mini-note</a>
              <button class="btn" onclick="askAI('Explain UK CPI vs core inflation in simple terms, with a 2-sentence example')">Ask AI</button>
            </div>
          </div>
        </div>

        <div class="project-card fade-in">
          <div class="project-content">
            <h3 class="project-title">Compounding</h3>
            <p class="project-description">
              Compounding lets your returns earn returns. Small, consistent gains (in skills, money, or habits)
              all compound when you keep the flywheel turning.
            </p>
            <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
              <a href="#" class="btn">Read mini-note</a>
              <button class="btn" onclick="askAI('Explain the power of compounding for creators and skill building')">Ask AI</button>
            </div>
          </div>
        </div>

        <!-- New AI-Enhanced Cards -->
        <div class="project-card fade-in">
          <div class="project-content">
            <h3 class="project-title">Market Psychology</h3>
            <p class="project-description">
              Fear and greed drive the market in the short run. Long-term returns depend more on fundamentals and your behavior.
            </p>
            <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
              <a href="#" class="btn">Read mini-note</a>
              <button class="btn" onclick="askAI('Give a short example of how fear and greed affect stock prices in the short term')">Ask AI</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- AI Assistant Section -->
    <section class="assistant container" id="assistant">
      <h2 class="section-title">Ask the Assistant</h2>
      <div class="chat-container">
        <div id="chatMessages" class="chat-messages">
          <div class="message bot-message">
            <div class="message-content">Hi! Iâ€™m your economics assistant. Ask me anythingâ€”monetary policy, inflation, investing basics, and more.</div>
          </div>
        </div>

        <div class="chat-input">
          <input id="messageInput" type="text" placeholder="Type your questionâ€¦" autocomplete="off"/>
          <button id="sendButton" class="btn">Send</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container footer-grid">
      <div class="footer-col">
        <h4>JojoJubah</h4>
        <p>Notes and tools to make economics clearer for creators.</p>
      </div>
      <div class="footer-col">
        <h4>Links</h4>
        <ul class="footer-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="economics.html">Economics</a></li>
          <li><a href="labs.html">Labs</a></li>
          <li><a href="https://www.youtube.com/@jojojubah" target="_blank" rel="noopener">YouTube</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>Social</h4>
        <ul class="footer-links">
          <li><a href="https://www.youtube.com/@jojojubah" target="_blank" rel="noopener">YouTube</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">Â© <span id="year"></span> JojoJubah. All rights reserved.</div>
  </footer>

  <!-- Scripts -->
  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js";

    // Your Firebase config (public)
    const firebaseConfig = {
      apiKey: "AIzaSyCBnpzb54f0WbeIDgvdj4T0HRb3a2NdCgY",
      authDomain: "jojojubah-f2996.firebaseapp.com",
      projectId: "jojojubah-f2996",
      storageBucket: "jojojubah-f2996.appspot.com",
      messagingSenderId: "657950730640",
      appId: "1:657950730640:web:0b1b0c7ebd1b24b6f1f3ab"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const functions = getFunctions(app);

    // Expose for other scripts if needed
    window.app = app;
    window.db = db;

    // ---------- Market banner logic ----------
    let isLoading = false;

    async function loadMarketBanner(showStatus = false) {
      console.log('loadMarketBanner called, isLoading:', isLoading);
      
      if (isLoading) return;
      
      const track1 = document.getElementById('tickerTrack1');
      const track2 = document.getElementById('tickerTrack2');
      const refreshButton = document.getElementById('refreshBanner');
      
      console.log('Elements check - track1:', !!track1, 'track2:', !!track2, 'refresh:', !!refreshButton);
      
      if (!track1 || !track2) {
        console.error('Ticker track elements not found!');
        return;
      }

      // status UI
      if (refreshButton && showStatus) {
        refreshButton.setAttribute('disabled', 'true');
        refreshButton.classList.add('loading');
      }
      
      isLoading = true;
      
      try {
        // Call your Cloud Function that returns { banner: string }
        const getMarketBanner = httpsCallable(functions, 'getMarketBanner');
        const result = await getMarketBanner();
        console.log('Banner result:', result?.data);

        if (result?.data?.banner) {
          // Split into items regardless of spacing around the bullet and re-add bullets between items
          const items = result.data.banner
            .split(/â€¢/g)
            .map((txt, i, arr) => `<span class="ticker-item">${txt.trim()}${i < arr.length - 1 ? " â€¢" : ""}</span>`)
            .join("");

          if (track1 && track2) {
            track1.innerHTML = items;
            track2.innerHTML = items;
          }
        } else {
          console.warn('No banner data in result:', result);
          const fallbackText = 'ðŸ“Š No market data received';
          if (track1 && track2) {
            track1.innerHTML = `<span class="ticker-item">${fallbackText}</span>`;
            track2.innerHTML = `<span class="ticker-item">${fallbackText}</span>`;
          }
        }
      } catch (error) {
        console.error('Error loading market banner:', error);
        const errorText = 'ðŸ“Š Market data temporarily unavailable';
        const track1 = document.getElementById('tickerTrack1');
        const track2 = document.getElementById('tickerTrack2');
        if (track1 && track2) {
          track1.innerHTML = `<span class="ticker-item">${errorText}</span>`;
          track2.innerHTML = `<span class="ticker-item">${errorText}</span>`;
        }
      } finally {
        isLoading = false;
        refreshButton?.removeAttribute('disabled');
        refreshButton?.classList.remove('loading');
        console.log('Loading completed');
      }
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Market banner script initialized');
      
      const refreshButton = document.getElementById('refreshBanner');
      if (refreshButton) {
        refreshButton.addEventListener('click', () => loadMarketBanner(true));
      }

      // Initial load
      loadMarketBanner(false);

      // Optional: refresh every 5 minutes (comment out to disable)
      // setInterval(() => loadMarketBanner(false), 5 * 60 * 1000);
    });

    // ---------- Chat/Assistant logic ----------
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    sendButton?.addEventListener('click', sendMessage);
    messageInput?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    async function sendMessage() {
      const text = messageInput.value.trim();
      if (!text) return;

      messageInput.disabled = true;
      sendButton.disabled = true;

      displayMessage(text, true);
      
      try {
        const getAIResponse = httpsCallable(functions, 'getAIResponse');
        const result = await getAIResponse({ message: text });
        const reply = result?.data?.reply || "Sorry, I encountered an error. Please try again in a moment.";
        displayMessage(reply, false);
      } catch (err) {
        console.error(err);
        displayMessage("Sorry, I encountered an error. Please try again in a moment.", false);
      } finally {
        messageInput.value = "";
        messageInput.disabled = false;
        sendButton.disabled = false;
        messageInput.focus();
      }
    }

    function displayMessage(text, isUser) {
      const div = document.createElement('div');
      div.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
      const content = document.createElement('div');
      content.className = 'message-content';
      content.textContent = text;
      div.appendChild(content);
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Fix iOS Safari viewport height and scroll issues
    function fixIOSViewport() {
      // Set CSS custom property for proper viewport height
      let vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    // Fix on load and resize
    window.addEventListener('load', fixIOSViewport);
    window.addEventListener('resize', fixIOSViewport);
    window.addEventListener('orientationchange', fixIOSViewport);
  </script>

</body>
</html>
